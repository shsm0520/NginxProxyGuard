# nginx-proxy-guard ModSecurity Detection Only Mode
# Logs threats but does not block them

# Set detection only mode FIRST
SecRuleEngine DetectionOnly

# Include base ModSecurity configuration
Include /etc/nginx/modsec/modsec-base.conf

# Include OWASP CRS setup
Include /etc/nginx/owasp-crs/crs-setup.conf

# Include OWASP CRS rules
Include /etc/nginx/owasp-crs/rules/*.conf

# Custom nginx-proxy-guard rules
Include /etc/nginx/modsec/custom-rules.conf

# =============================================================================
# Rule Exclusions (must come AFTER CRS rules are loaded)
# =============================================================================

# Exclude Supabase auth cookies from RCE detection (rule 932260)
# Supabase uses cookies with "base64-" prefix which triggers false positives
# Cookie pattern: sb-*-auth-token.*
SecRuleUpdateTargetById 932260 "!REQUEST_COOKIES:/^sb-[a-z0-9]+-auth-token/"
